#!/usr/bin/env bash

DIRECTORIES=(
    $HOME/designs
    $HOME/code/work
    $HOME/tools
    $HOME/Desktop/screenshots
)

MESLOFONTS=(
    Regular.ttf
    Bold.ttf
    Italic.ttf
)

step "Making directories…"
for dir in ${DIRECTORIES[@]}; do
    mkdir -p $dir
done

step "Installing fonts…"
for font in ${MESLOFONTS[@]}; do
    if [ ! -e ~/Library/Fonts/MesloLGS\ NF\ $font ]; then
        printf "${indent}  [↓] $font "
        wget -P ~/Library/Fonts https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20$font --quiet
        print_success "${bold}✓ done!${normal}\n"
    else
        print_success_muted "${indent}✓ $font already installed. Skipped."
    fi
done

step "Installing Meslo Bold Italic font"
if [ ! -e ~/Library/Fonts/MesloLGS\ NF\ Bold\ Italic.ttf ]; then
    printf "${indent}  [↓] MesloLGS NF Bold Italic"
    wget -P ~/Library/Fonts https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold%20Italic.ttf --quiet
    print_success "${bold}✓ done!${normal}\n"
else
    print_success_muted "${indent}✓ MesloLGS NF Bold Italic already installed. Skipped."
fi

step "Download iTerm2 material color scheme"
wget -P $HOME/tools https://raw.githubusercontent.com/MartinSeeler/iterm2-material-design/master/material-design-colors.itermcolors
print_success "${bold}✓ done!${normal}\n"

step "Set up iTerm2 Profiles"
iterm_folder="${HOME}/Library/Application Support/iTerm2/DynamicProfiles"

sudo mkdir -p $iterm_folder

if [[ -d $iterm_folder ]]; then
    cp $cwd/customisations/iterm/*.json ~/Library/Application\ Support/iTerm2/DynamicProfiles/
    print_success "Successfully copied profiles - enable via iTerm preferences"
else
    print_success_muted "Path does not exist: ${iterm_folder}. Skipped"
fi

step "Install ZSH Completions"
zshdir=$HOME/.oh-my-zsh

if [[ -d $zshdir ]]; then
    git clone https://github.com/zsh-users/zsh-completions ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/plugins/zsh-completions
    print_success "zsh completions plugin installed"
else print_success_muted "zsh completions plugin not installed. Skipping"
fi

step "Copy zshrc"
zshrc=$cwd/customisations/.zshrc
if [ -e $zshrc ]; then
    cp $zshrc $HOME
    print_success ".zshrc file successfully copied"
else print_success_muted "No .zshrc file found. Skipping"
fi


step "Copy p10k config"
p10_config=$cwd/customisations/.p10k.zsh
if [ -e $p10_config ]; then
    cp $p10_config $HOME
    print_success ".p10k.zsh file successfully copied"
else print_success_muted "No .p10k.zsh file found. Skipping"
fi

step "Copy vscode settings"
code_settings=$cwd/customisations/code/settings.json
if [ -e $code_settings ]; then
    cp $code_settings ~/Library/Application\ Support/Code/User/
     print_success "vscode settings json successfully copied"
else print_success_muted "No settings file found. Skipping"
fi

step "Copy vscode keybindings"
code_keybindings=$cwd/customisations/code/keybindings.json
if [ -e $code_keybindings ]; then
    cp $code_keybindings ~/Library/Application\ Support/Code/User/
     print_success "vscode keybindings file successfully copied"
else print_success_muted "No keybindings file found. Skipping"
fi

step "Copy gitconfig"
gitconfig=$cwd/customisations/.gitconfig
if [ -e $gitconfig ]; then
    cp $gitconfig $HOME
     print_success ".gitconfig file successfully copied"
else print_success_muted "No .gitconfig file found. Skipping"
fi

step "MacOS Configuration"
if [ -e $cwd/customisations/macos ]; then
    . "$cwd/customisations/macos"
     print_success "macOS configuration successful"
else print_success_muted "No macOS configuration file found. Skipping"
fi